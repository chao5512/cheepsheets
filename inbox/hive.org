#+title: hive
* 概念
1. 面向海量结构化数据
2. 基于hadoop的数据仓库工具

   1. 存储基于hdfs

   2. 计算基于(默认)mr

   3. 使用yarn来调度资源

3. 提供sql-like查询
4. 将sql转化为mr任务
5. extract/transform/load (ETL)

** 优缺点
*** 缺点
1. 迭代式运算无法表达,太慢
* 组件

** 内建的
1. 解析器
2. 编译器
3. 优化器
4. 执行器

** 外部依赖的
1. metastore (derby or mysql)
2. hdfs
3. mr

* 建表
todo 

** 查看建表语句
#+begin_src sql
  show create table tablename;
#+end_src

* 数据导入

** 直接导入hdfs
#+begin_src sh
  # 1. load
  load data local inpath '/xxx/xxx' into table student;
  # 2. put
  # 3. 直接从hdfs导入
  # 直接put到 /user/hive/wirehouse
#+end_src

* sql

** 删除有表的数据库
#+begin_src sql
  drop table tablename cascade;
#+end_src

** 查看表
#+begin_src sql
  show tables
  show tables from database_name
#+end_src

** 查看表的数据位置
#+begin_src sql
  desc formatted student;
#+end_src

** 更改表的列
#+begin_src sql


#+end_src

** DML

*** load
#+begin_src sql
  LOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]
  # filepath
  ## 1. 相对路径
  ## 2. 绝对路径
  ## 3. 完整的uri 包括schema和权限
  LOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)] [INPUTFORMAT 'inputformat' SERDE 'serde'] (3.0 or later)
#+end_src
1. target load的目标可以是table或者partition,如果表指定了分区,那么这个导入必须指定分区
2. filePath 可以是file/dir
3. 指定LOCAL的意思是,从本地文件系统找
4. 不指定LOCAL
   1. 当schema和权限没有指定的时候,从hive配置的hadoopconf里面找fs.default.name
5. OVERWRITE, 覆盖原来hive分区中的内容
6. additional ops after hive3.0

**** 摘要
3.0之前的load操作只是简单把数据文件copy/move到hive表能找到的存储位置上

* in action

** 关键字作为字段
使用``括起来,例如`timestamp`

* todo

** 传统数仓和OLAP\OLTP的区别

