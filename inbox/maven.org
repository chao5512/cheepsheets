#+title: maven
* inbox
1. mvn -X ： 查看当前mvn使用配置文件
** 远程仓库的依赖下载不下来403错误
***  最后的办法
1. 下载jar包
2. mvn install:install-file -DgroupId=com.google.errorprone -DartifactId=javac -Dversion=9+181-r4173-1 -Dpackaging=jar -Dfile=javac-9+181-r4173-1.jar
** 指定语言(jdk)level
#+BEGIN_SRC xml
  <properties>
          <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
          <encoding>UTF-8</encoding>
          <java.version>1.8</java.version>
          <maven.compiler.source>1.8</maven.compiler.source>
          <maven.compiler.target>1.8</maven.compiler.target>
      </properties>
#+END_SRC
* repository
** 配置公司仓库不生效
cause by [[https://blog.csdn.net/lovewebeye/article/details/80060410?utm_source=blogxgwz5][私有仓库不生效]]
solution 更改mirrorOf属性
** 配置国内源
todo 配置文件的生效顺序
** 阿里仓库也有不全的时候
*** replay
1. 通过mvn clean install 编译incubator-doris项目,成功下载java-cup-runtime和cup-maven-plugin到本地仓库
2. 为了学习jflex和cup,新建了一个项目,把cup和jflex的依赖语句抄过来.
3. cup相关的依赖无法找到依赖.
4. 检查本地仓库,步骤3中提示的依赖确实是存在的
5. 远程仓库为阿里仓库,阿里仓库中没有cup的插件和cup-runtime插件
6. 此时就算本地仓库是有的,在第一步verrify时候还是要从远程仓库检查这个包的信息做验证.此时就会导致验证过不了,下载也下不了
*** 总结
1. 问题一: 多设置几个源,覆盖更多的依赖
2. 问题而: 使用profile动态配置
*** 使用动态配置(profiles)
在某个阶段,动态加入某个特殊仓库
#+BEGIN_SRC xml
  <profiles>
          <profile>
              <id>general-env</id>
              <!--激活时机-->
              <activation>
                <!--property是使用-D参数来决定激活否-->
                <property>
                  <!--如果mvn clean install -Denv.CUSTOM_MAVEN_REPO=anyvalue,只要这个参数为空,就激活此profile-->
                      <name>!env.CUSTOM_MAVEN_REPO</name>
                  </property>
              </activation>
              <repositories>
                  <!-- for java-cup -->
                  <repository>
                      <id>cloudera-thirdparty</id>
                      <url>https://repository.cloudera.com/content/repositories/third-party/</url>
                  </repository>
              </repositories>
              <pluginRepositories>
                  <!-- for cup-maven-plugin -->
                  <pluginRepository>
                      <id>spring-plugins</id>
                      <url>https://repo.spring.io/plugins-release/</url>
                  </pluginRepository>
              </pluginRepositories>
          </profile>
      </profiles>
#+END_SRC
* build
[[https://blog.csdn.net/riju4713/article/details/85102471][跳过test]]
** 打包带依赖，指定主类
#+BEGIN_SRC xml
        <plugin>
           <groupId>org.apache.maven.plugins</groupId>
           <artifactId>maven-shade-plugin</artifactId>
           <version>2.4.3</version>
           <executions>
                <execution>
                  <phase>package</phase>
                  <goals>
                    <goal>shade</goal>
                  </goals>
                  <configuration>
                    <filters>
                      <filter>
                        <artifact>*:*</artifact>
                        <excludes>
                          <exclude>META-INF/*.SF</exclude>
                          <exclude>META-INF/*.DSA</exclude>
                          <exclude>META-INF/*.RSA</exclude>
                        </excludes>
                      </filter>
                    </filters>
                    <transformers>
                      <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                        <mainClass></mainClass>
                      </transformer>
                    </transformers>
                  </configuration>
                </execution>
              </executions>
            </plugin>

#+END_SRC
* geting start
maven提供清晰的构建套路，mvn可以方便的管理：
** builds
** Documentation

** Reporting
** Dependencies
** SCMs
** Releases
** Distribution
* make a project with mvn

** 命令
#+BEGIN_SRC sh
  mvn archetype:generate
#+END_SRC
** -B 批量执行命令，不加-B可以交互式的按模板生成项目
#+BEGIN_SRC sh
  mvn -B archetype:generate \
    -DarchetypeGroupId=org.apache.maven.archetypes \
    -DgroupId=com.mycompany.app \
    -DartifactId=my-app
#+END_SRC
** pom
*** super pom
默认的超级父类，除非另外设置，不然项目中的所有pom都继承自这个pom
*** 最小pom
#+begin_example
  project root
  modelVersion - should be set to 4.0.0
  groupId - the id of the project's group.
  artifactId - the id of the artifact (project)
  version - the version of the artifact under the specified group
#+end_example
*** dependency
**** scope

** 继承性
dependencies
developers and contributors
plugin lists (including reports)
plugin executions with matching ids
plugin configuration
resources

*** 父工程一般定义打包方式为pom

*** super pom
像java中所有对象都默认继承Object，maven中所有pom都继承自一个super pom

* setting
** 两个settings.xml
*** global
${maven.home}/conf/settings.xml
*** user
${user.home}/.m2/settings.xml
** 
* maven进阶
[[https://www.cnblogs.com/davenkin/p/advanced-maven-multi-module-vs-inheritance.html][Ref]]
** 多模块和继承
多模块和继承关闭不比同时存在
1. 多模块可以将执行顺序推给maven
2. 继承是用于所有子模块共享父模块的配置，比如junit依赖
* plugin
** jacoco
java code coverage 分析单元测试覆盖率的插件
[[https://developer.ibm.com/zh/articles/j-lo-jacoco/][eclemama]]
* in action

** logback error - multipul bindings 
[[https://www.jianshu.com/p/9342d313e01a][Ref]]
*** logs
#+BEGIN_SRC sh
  SLF4J: Class path contains multiple SLF4J bindings.
  SLF4J: Found binding in [jar:file:/Users/x/.m2/repository/org/slf4j/slf4j-log4j12/1.7.25/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]
  SLF4J: Found binding in [jar:file:/Users/x/.m2/repository/ch/qos/logback/logback-classic/1.1.2/logback-classic-1.1.2.jar!/org/slf4j/impl/StaticLoggerBinder.class]
  SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]
#+END_SRC
*** solution 1
使用桥接器
*** solution 2
借助mvn
**** take a look of all dependencies
#+BEGIN_SRC sh
  dependency:tree
#+END_SRC
**** exclution the 多余 bindings
#+BEGIN_SRC xml
  <dependency>
    <groupId>com.facebook.airlift</groupId>
    <artifactId>bootstrap</artifactId>
    <version>0.186</version>
    <exclusions>
      <exclusion>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-jdk14</artifactId>
      </exclusion>
      <exclusion>
        <groupId>org.slf4j</groupId>
        <artifactId>log4j-over-slf4j</artifactId>
      </exclusion>
      <exclusion>
        <groupId>org.slf4j</groupId>
        <artifactId>jcl-over-slf4j</artifactId>
      </exclusion>
    </exclusions>
  </dependency>
#+END_SRC
