#+title: ceph 的crush算法
* 参考
https://blog.csdn.net/yuxin6866/article/details/79609389
* crush
一个可伸缩的伪随机的数据分布方法,由此,分布式存储系统可以不依赖一个中心节点来完成数据的定位
** 摘要
对于大型的分布式系统,其动态即为常态.因此,crush需要有能力处理storage的添加和删除,同时又要尽量避免不必要的数据移动.
** object-based storage devices (OSDs)
最基本的存储单位为Named-obj,文件也要拆成obj来存储.
*** 副本分布方案
**** 单次写入平衡:负载平衡来做机器选择的算法
1. 单次写入总写入相对未充分利用的服务,对于存储来说,就是选择一块剩余空间更多的divice
2. 这种设计的缺陷是,新的写入全都会被分配到新加入的盘上
**** 基于现有的storage来做随机
当系统中有新加入的磁盘,需要re-shuffing
**** cursh
1. 伪随机
2. 前提,cursh需要了解两点
   1. 集群的拓扑
   2. 分布策略
3. 优点
   1. 可以从任何地方独立的算出副本位置
   2. 元数据大多时候是不变的,只有在集群拓扑发生变化的时候才改变
*** crush的特点
1. 分布副本,以充分利用资源(磁盘,并行度,聚合带宽)
2. 拓扑结构变化时的reorganize data
3. 支持灵活的副本分布约束(策略)
4. 支持多种数据安全策略(n-way replication, raid)
*** Crush and Rush
都是用映射来做数据分布,而不是显式的元数据
** Crush 算法
*** 基本组成
1. 集群拓扑
   1. 要考虑存储设备的权重,不同类型的存储设备的性能不同,要充分利用
   2. 桶的定义
      1. row 一排机柜
      2. cabinet 一个机柜
      3. 

2. 放置策略
   1. 选几个
   2. 哪几个
*** 

